import os
import sys

# Add the project root to the Python path to allow absolute imports from 'src'
sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), "../../..")))

# src/core/tests/conftest.py
from src.core.utils import parse_puzzle_layout

# This list holds all puzzle data for parametrized tests.
# It is imported by test files.
# The format for each item is a tuple: (puzzle_dictionary, expected_solution, test_id)

# --- Puzzle Definitions ---

# Puzzle 01 Data
puzzle_01_layout = [
    ["  ", "  ", "  ", "  ", "  ", "  "],
    ["  ", "01", "  ", "  ", "02", "  "],
    ["  ", "  ", "03", "04", "  ", "  "],
    ["  ", "  ", "06", "05", "  ", "  "],
    ["  ", "08", "  ", "  ", "07", "  "],
    ["  ", "  ", "  ", "  ", "  ", "  "],
]
puzzle_01_data = parse_puzzle_layout(puzzle_01_layout)
puzzle_01_data["walls"] = {
    tuple(sorted(((1, 0), (1, 1)))),
    tuple(sorted(((0, 1), (1, 1)))),
    tuple(sorted(((2, 1), (2, 2)))),
    tuple(sorted(((1, 3), (2, 3)))),
    tuple(sorted(((1, 4), (2, 4)))),
    tuple(sorted(((3, 3), (3, 4)))),
    tuple(sorted(((3, 1), (4, 1)))),
    tuple(sorted(((3, 2), (4, 2)))),
    tuple(sorted(((4, 4), (4, 5)))),
    tuple(sorted(((4, 4), (5, 4)))),
}
solution_01 = [
    (1, 1),
    (2, 1),
    (2, 0),
    (1, 0),
    (0, 0),
    (0, 1),
    (0, 2),
    (0, 3),
    (0, 4),
    (0, 5),
    (1, 5),
    (1, 4),
    (1, 3),
    (1, 2),
    (2, 2),
    (2, 3),
    (3, 3),
    (3, 2),
    (3, 1),
    (3, 0),
    (4, 0),
    (5, 0),
    (5, 1),
    (5, 2),
    (5, 3),
    (5, 4),
    (5, 5),
    (4, 5),
    (3, 5),
    (2, 5),
    (2, 4),
    (3, 4),
    (4, 4),
    (4, 3),
    (4, 2),
    (4, 1),
]

# Puzzle 02 Data
puzzle_02_layout = [
    ["  ", "  ", "05", "08", "  ", "  "],
    ["  ", "  ", "12", "  ", "09", "  "],
    ["04", "  ", "  ", "  ", "  ", "01"],
    ["  ", "  ", "06", "07", "  ", "  "],
    ["  ", "11", "  ", "  ", "10", "  "],
    ["03", "  ", "  ", "  ", "  ", "02"],
]
puzzle_02_data = parse_puzzle_layout(puzzle_02_layout)
puzzle_02_data["walls"] = set()
solution_02 = [
    (2, 5),
    (3, 5),
    (4, 5),
    (5, 5),
    (5, 4),
    (5, 3),
    (5, 2),
    (5, 1),
    (5, 0),
    (4, 0),
    (3, 0),
    (2, 0),
    (1, 0),
    (0, 0),
    (0, 1),
    (0, 2),
    (1, 2),
    (2, 2),
    (3, 2),
    (3, 3),
    (2, 3),
    (1, 3),
    (0, 3),
    (0, 4),
    (0, 5),
    (1, 5),
    (1, 4),
    (2, 4),
    (3, 4),
    (4, 4),
    (4, 3),
    (4, 2),
    (4, 1),
    (3, 1),
    (2, 1),
    (1, 1),
]

# Puzzle 03 Data
puzzle_03_layout = [
    ["12", "  ", "11", "  ", "09", "  "],
    ["02", "  ", "01", "  ", "10", "  "],
    ["  ", "  ", "  ", "  ", "  ", "  "],
    ["  ", "  ", "  ", "  ", "  ", "  "],
    ["  ", "08", "  ", "07", "  ", "06"],
    ["  ", "03", "  ", "04", "  ", "05"],
]
puzzle_03_data = parse_puzzle_layout(puzzle_03_layout)
puzzle_03_data["walls"] = {
    tuple(sorted(((2, 1), (3, 1)))),
    tuple(sorted(((2, 2), (3, 2)))),
    tuple(sorted(((2, 3), (3, 3)))),
    tuple(sorted(((2, 4), (3, 4)))),
}
solution_03 = [
    (1, 2),
    (2, 2),
    (2, 1),
    (1, 1),
    (1, 0),
    (2, 0),
    (3, 0),
    (4, 0),
    (5, 0),
    (5, 1),
    (5, 2),
    (5, 3),
    (5, 4),
    (5, 5),
    (4, 5),
    (4, 4),
    (4, 3),
    (4, 2),
    (4, 1),
    (3, 1),
    (3, 2),
    (3, 3),
    (3, 4),
    (3, 5),
    (2, 5),
    (1, 5),
    (0, 5),
    (0, 4),
    (1, 4),
    (2, 4),
    (2, 3),
    (1, 3),
    (0, 3),
    (0, 2),
    (0, 1),
    (0, 0),
]

# Puzzle 04 Data
puzzle_04_layout = [
    ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
    ["  ", "07", "  ", "06", "  ", "10", "  "],
    ["  ", "  ", "08", "  ", "09", "  ", "  "],
    ["  ", "12", "  ", "  ", "  ", "11", "  "],
    ["  ", "  ", "03", "  ", "02", "  ", "  "],
    ["  ", "04", "  ", "05", "  ", "01", "  "],
    ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
]
puzzle_04_data = parse_puzzle_layout(puzzle_04_layout)
puzzle_04_data["walls"] = {
    tuple(sorted(((0, 3), (1, 3)))),
    tuple(sorted(((1, 3), (2, 3)))),
    tuple(sorted(((2, 1), (3, 1)))),
    tuple(sorted(((2, 2), (3, 2)))),
    tuple(sorted(((2, 3), (3, 3)))),
    tuple(sorted(((2, 4), (3, 4)))),
    tuple(sorted(((2, 5), (3, 5)))),
    tuple(sorted(((3, 1), (4, 1)))),
    tuple(sorted(((3, 2), (4, 2)))),
    tuple(sorted(((3, 3), (4, 3)))),
    tuple(sorted(((3, 4), (4, 4)))),
    tuple(sorted(((3, 5), (4, 5)))),
    tuple(sorted(((4, 3), (5, 3)))),
    tuple(sorted(((5, 3), (6, 3)))),
}
solution_04 = [
    (5, 5),
    (6, 5),
    (6, 6),
    (5, 6),
    (4, 6),
    (4, 5),
    (4, 4),
    (4, 3),
    (4, 2),
    (4, 1),
    (5, 1),
    (5, 2),
    (5, 3),
    (5, 4),
    (6, 4),
    (6, 3),
    (6, 2),
    (6, 1),
    (6, 0),
    (5, 0),
    (4, 0),
    (3, 0),
    (2, 0),
    (1, 0),
    (0, 0),
    (0, 1),
    (0, 2),
    (0, 3),
    (0, 4),
    (1, 4),
    (1, 3),
    (1, 2),
    (1, 1),
    (2, 1),
    (2, 2),
    (2, 3),
    (2, 4),
    (2, 5),
    (1, 5),
    (0, 5),
    (0, 6),
    (1, 6),
    (2, 6),
    (3, 6),
    (3, 5),
    (3, 4),
    (3, 3),
    (3, 2),
    (3, 1),
]

# Puzzle 05 Data
puzzle_05_layout = [
    ["12", "11", "  ", "  ", "  ", "  "],
    ["  ", "10", "  ", "  ", "  ", "  "],
    ["09", "08", "07", "  ", "  ", "  "],
    ["  ", "  ", "  ", "05", "04", "  "],
    ["  ", "  ", "  ", "  ", "03", "  "],
    ["  ", "  ", "  ", "06", "01", "02"],
]
puzzle_05_data = parse_puzzle_layout(puzzle_05_layout)
puzzle_05_data["walls"] = {
    tuple(sorted(((1, 3), (1, 4)))),
    tuple(sorted(((1, 4), (1, 5)))),
    tuple(sorted(((4, 0), (4, 1)))),
    tuple(sorted(((4, 1), (4, 2)))),
}
solution_05 = [
    (5, 4),
    (5, 5),
    (4, 5),
    (4, 4),
    (3, 4),
    (3, 5),
    (2, 5),
    (1, 5),
    (0, 5),
    (0, 4),
    (1, 4),
    (2, 4),
    (2, 3),
    (3, 3),
    (4, 3),
    (5, 3),
    (5, 2),
    (4, 2),
    (3, 2),
    (2, 2),
    (2, 1),
    (3, 1),
    (4, 1),
    (5, 1),
    (5, 0),
    (4, 0),
    (3, 0),
    (2, 0),
    (1, 0),
    (1, 2),
    (1, 3),
    (0, 3),
    (0, 2),
    (0, 1),
    (0, 0),
]


# Puzzle 06 Data
puzzle_06_layout = [
    ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
    ["04", "  ", "05", "17", "  ", "18", "06"],
    ["03", "  ", "  ", "16", "  ", "  ", "07"],
    ["13", "  ", "02", "01", "  ", "19", "08"],
    ["12", "  ", "15", "  ", "  ", "  ", "09"],
    ["11", "  ", "14", "21", "  ", "20", "10"],
    ["  ", "  ", "  ", "  ", "  ", "  ", "  "],
]
puzzle_06_data = parse_puzzle_layout(puzzle_06_layout)
puzzle_06_data["walls"] = set()
solution_06 = [
    (3, 3),
    (3, 2),
    (2, 2),
    (2, 1),
    (2, 0),
    (1, 0),
    (0, 1),
    (1, 1),
    (1, 2),
    (0, 2),
    (0, 3),
    (0, 4),
    (0, 5),
    (0, 6),
    (1, 6),
    (2, 6),
    (3, 6),
    (4, 6),
    (5, 6),
    (6, 6),
    (6, 5),
    (6, 4),
    (6, 3),
    (6, 2),
    (6, 1),
    (6, 0),
    (5, 0),
    (4, 0),
    (3, 0),
    (3, 1),
    (4, 1),
    (5, 1),
    (5, 2),
    (4, 2),
    (4, 3),
    (4, 4),
    (3, 4),
    (2, 4),
    (2, 3),
    (1, 3),
    (1, 4),
    (1, 5),
    (2, 5),
    (3, 5),
    (4, 5),
    (5, 5),
    (5, 4),
    (5, 3),
]


# --- Test Suite ---
# This list holds all puzzle data for parametrized tests.
puzzles_to_test = [
    (puzzle_01_data, solution_01, "puzzle_01"),
    (puzzle_02_data, solution_02, "puzzle_02"),
    (puzzle_03_data, solution_03, "puzzle_03"),
    (puzzle_04_data, solution_04, "puzzle_04"),
    (puzzle_05_data, solution_05, "puzzle_05"),
    (puzzle_06_data, solution_06, "puzzle_06"),
]
